Этот скрипт конвертирует HTML-файлы в Markdown (`.md`) с добавлением YAML-фронтматера (метаданных в формате `---`). Вот как он работает:

### **Откуда берёт данные**
1. **Входной файл** (`--in`):
   - Скрипт принимает **один HTML-файл**, указанный в аргументе `--in`.
   - Пример:  
     ```bash
     python convert_html_to_md.py --in "data/Компетенции/Универсальные механизмы/page.html"
     ```

2. **Дополнительные параметры**:
   - `--category` (например, `faq`, `skills`) — добавляет категорию в метаданные.
   - `--section` (например, `"Универсальные механизмы"`) — добавляет раздел в метаданные.
   - `DEPARTMENT` (переменная окружения) — если задана, файлы ищутся в `data/{DEPARTMENT}/...`.

---

### **Куда сохраняет результат**
1. **Автоматически** (если `--out` не указан):
   - Скрипт создаёт папку `md` **рядом с исходным HTML-файлом**.
     - Например, для `data/foo/bar.html` результат сохранится в `data/foo/md/bar.md`.
   - Если задана `DEPARTMENT`, базовый путь меняется на `data/{DEPARTMENT}/`.

2. **Вручную** (через `--out`):
   - Можно явно указать папку для сохранения:
     ```bash
     python convert_html_to_md.py --in input.html --out "output_dir/"
     ```
   - В этом случае все `.md` файлы сохранятся в `output_dir/`.

---

### **Что делает скрипт**
1. **Извлекает контент**:
   - Удаляет шапку/меню (использует `readability-lxml`).
   - Сохраняет основной текст статьи.

2. **Формирует метаданные** (YAML-фронтматер):
   - Заголовок (`question`).
   - URL (если HTML сохранён через «Сохранить как» в браузере).
   - Дату (`imported` — время конвертации, `date` — дата публикации, если найдена).
   - Категорию и раздел (из аргументов `--category` и `--section`).

3. **Конвертирует в Markdown**:
   - Использует `html2text` для преобразования HTML → Markdown.
   - Сохраняет ссылки, но игнорирует изображения (`ignore_images=True`).

4. **Правила для специфичных сайтов** (например, `its.1c.ru`):
   - В коде есть функции для дополнительной обработки HTML (извлечение даты, автора и т.д.).

---

### **Пример запуска**

```bash
# Для одного файла
python convert_html_to_md.py \
    --in "data/Компетенции/Универсальные механизмы/page.html" \
    --category skills \
    --section "Универсальные механизмы"

# Для всех HTML-файлов в папке (пример из комментария в коде)
OUT_DIR="data/Компетенции/Универсальные механизмы/md"
for f in "data/Компетенции/Универсальные механизмы"/*.html; do
  python convert_html_to_md.py \
      --in "$f" \
      --out "$OUT_DIR" \
      --category skills \
      --section "Универсальные механизмы"
done
```

---

### **Важные нюансы**
- Если `.md` файл уже существует и новее исходного HTML, скрипт пропускает конвертацию (чтобы не перезаписывать без необходимости).
- Имена выходных файлов формируются из заголовка (например, `Как-настроить-доступ.md`).
- Для кириллических названий используется транслитерация (через `unidecode`).